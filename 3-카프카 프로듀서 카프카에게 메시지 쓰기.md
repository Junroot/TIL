---
title: "3-카프카 프로듀서: 카프카에게 메시지 쓰기"
tags:
  - 도서/카프카-핵심-가이드
---
## 프로듀서 개요

- 카프카에 메시지를 써야 하는 상황에 따라 요구사항이 다양하다.
	- 메시지 유실이 용납되지 않는지
	- 중복이 허용되도 상관없는지
	- 반드시 지켜야할 지연이나 처리율이 있는지
- 이처럼 서로 다른 요구 조건은 카프카에 메시지를 쓰기 위해 프로듀서 API를 사용하는 방식과 설정에 영향을 미친다.
- 프로듀서 메시지 전송 과정
	1. `ProducerRecord` 객체를 생성한다. 여기서는 레코드가 저장될 토픽과 밸류는 필수사항이지만, 키와 파티션 지정은 선택사항이다.
	2. `ProducerRecord`를 전송하는 API를 호출했을 때, 키와 값 객체가 네트워크 상에 전송될 수 있도록 직렬화해서 바이트 배열로 변환한다.
	3. 만약 파티션을 명시적으로 지정하지 안핬다면 해당 데이터를 파티셔녀에게로 보낸다. 파티셔너는 파티션을 결정하는 역할을 하는데, 그 기준은 보통 `PrdocuereRecord` 객체의 키의 값이다.
	4. 파티션이 결정되어 메시지가 전송될 토픽과 파티션이 확장되면 프로듀서는 이 레코드를 같은 토픽 파티션으로 전송될 레코드들을 모은 레코드 배치에 추가한다. 그러면 별도의 스레드가 이 레코드 배치를 적절한 카프카 브로커에게 전송한다.
	5. 메시지가 성공적으로 전송되었을 경우 브로커는 토픽, 파티션, 그리고 해당 파니션 안에서의 레코드의 오프셋을 담은 `RecordMetadata` 객체를 리턴한다. 메시지가 저장에 실패했을 경우에는 에러가 리턴되고, 에러를 수신하면 메시지 쓰기를 포기하고 사용자에게 에러를 리턴하기 전까지 몇 번 더 재전송을 시도할 수 있다.
	- ![](assets/Pasted%20image%2020250428012422.png)
