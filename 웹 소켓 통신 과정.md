---
tags:
  - α„‚α…¦α„α…³α„‹α…―α„α…³
  - WebSocket
---
# μ›Ή μ†μΌ“ ν†µμ‹  κ³Όμ •

- μ†μΌ“ μ—°κ²°μ„ μ μ§€ν•κΈ° λ•λ¬Έμ— μ–‘λ°©ν–¥ ν†µμ‹ μ΄ κ°€λ¥ν•λ‹¤. μ¦‰, μ›Ήμ—μ„ μ‚¬μ©ν•λ” μ†μΌ“μ΄λΌ ν•  μ μλ‹¤.
- μ›Ήμ†μΌ“κ³Ό HTTP ν”„λ΅ν† μ½ λ¨λ‘ OSI λ¨λΈμ—μ„ μ 7κ³„μΈµμΈ Application layerμ— ν•΄λ‹Ήν•λ©° μ 4κ³„μΈµμΈ TCPμ— μμ΅΄ν•λ‹¤.
- TCP μ†μΌ“μ—μ„λ” λ°”μ΄νΈ μ¤νΈλ¦Όμ„ μ‚¬μ©ν•μ§€λ§ μ›Ή μ†μΌ“μ—μ„λ” UTF-8 ν¬λ§·μ λ©”μ‹μ§€ μ¤νΈλ¦Όλ§ ν—μ©ν•λ‹¤.
- μ›Ήμ†μΌ“ ν†µμ‹  κ³Όμ •
    1. WebSocket Handshake
        1. ν΄λΌμ΄μ–ΈνΈ ν•Έλ“μ‰μ΄ν¬ μ”μ²­
           
            ```json
            GET /chat HTTP/1.1
            Host: example.com:8000
            Upgrade: websocket
            Connection: Upgrade
            Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
            Sec-WebSocket-Version: 13
            ```
            
            - `Upgrade`: μ›Ήμ†μΌ“ ν”„λ΅ν† μ½λ΅ ν”„λ΅ν† μ½μ„ λ³€κ²½ν•λ‹¤λ” μ”μ²­
            - `Sec-WebSocket-Key`: ν•Έλ“μ‰μ΄ν¬μ— ν•„μ”ν• ν‚¤
            - `Connection`: ν”„λ΅μ‹μ— λ” μ΄μƒ μ „μ†΅ν•μ§€ μ•λ” ν—¤λ” ν•„λ“λ¥Ό μ§€μ •ν•λ” ν—¤λ”λ‹¤. `Upgarde` ν—¤λ”λ” hop-by-hop ν—¤λ”κΈ° λ•λ¬Έμ— `Connection:Upgrade` κ°€ ν•„μ”ν•λ‹¤.
        2. μ„λ²„κ°€ λ³΄λ‚΄λ” ν•Έλ“μ‰μ΄ν¬ μ‘λ‹µ
           
            ```jsx
            HTTP/1.1 101 Switching Protocols
            Upgrade: websocket
            Connection: Upgrade
            Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
            ```
            
            - `Sec-WebSocket-Accept`: `Sec-WebSocket-Key` μ— μν•΄ μƒμ„ λ κ°’
        
        <aside>
        π’΅ μ›Ήμ†μΌ“ μ„λ²„λ” μ΄λ―Έ μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈλ“¤μ λ°λ³µμ μΈ μ—°κ²°(DoS κ³µκ²© λ“±)μ„ λ§‰κΈ°μ„ν•΄ ν΄λΌμ΄μ–ΈνΈμ μ†μΊ£ μƒνƒλ¥Ό μ¶”μ ν•΄μ•Όλλ‹¤.
        
        </aside>
        
    2. λ°μ΄ν„° ν”„λ μ„ κµν™
        - [λ§ν¬](https://developer.mozilla.org/ko/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#%EB%8D%B0%EC%9D%B4%ED%84%B0_%ED%94%84%EB%A0%88%EC%9E%84_%ED%8F%AC%EB%A9%A7)λ¥Ό μ°Έκ³ ν•λ©΄ λ°μ΄ν„° ν”„λ μ„μ κµ¬μ΅°λ¥Ό μ• μ μλ”λ° μ§μ ‘ μ‚¬μ©ν•  μΌμ΄ μμ„μ§€λ” λ¨λ¥΄κ² λ‹¤.
        - ν•Έλ“μ‰μ΄ν¬κ°€ λλ‚ μ΄ν›„ μ„λ²„λ‚ ν΄λΌμ΄μ–ΈνΈλ” μ–Έμ λ‚ pingμ„ λ³΄λ‚Ό μ μλ‹¤. μμ‚°μ§€λ” κ°€λ¥ν• λΉ¨λ¦¬ μ‘λ‹µμΌλ΅ pong ν¨ν‚·μ„ λ³΄λ‚΄μ•Όλλ‹¤. μ„λ²„λ” μ£Όμ μΌλ΅ pingμ„ λ³΄λ‚΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ‚΄μ•„μλ” μƒνƒμΈμ§€ μ²΄ν¬ν•  μ μλ‹¤.
    3. μ—°κ²° λ‹«κΈ°
        1. ν΄λΌμ΄μ–ΈνΈκ°€ close ν”„λ μ„μ„ μ„λ²„μ—κ² λ³΄λ‚Έλ‹¤.
        2. μμ‹ ν• μ„λ²„λ” close ν”„λ μ„μ„ λ³΄λ‚Έλ‹¤.
        
        ![%E1%84%8B%E1%85%B0%E1%86%B8%20%E1%84%89%E1%85%A9%E1%84%8F%E1%85%A6%E1%86%BA%20%E1%84%90%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%86%AB%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20ebea45d21b7d4691a10df71520e3fc67/Untitled.png](assets/Untitled_9.png)