# 가치 있는 단위 테스트를 위한 리팩터링

## 리팩터링할 코드 식별하기

### 코드의 네 가지 유형

- 모든 프로덕션 코드는 2차원으로 분류할 수 있다.
	- 복잡도 또는 도메인 유의성
		- 복잡도: 코드 내 의사 결정 지점 수로 정의한다.
		- 도메인 유의성: 코드가 프로젝트의 문제 도메인에 대해 얼마나 의미 있는지를 나타낸다.
		- 복잡한 콤드와 도메인 유의성을 갖는 코드가 단위 테스트에서 가장 이롭다.
	- 협력자 수: 가변 의존성이거나 프로젝트 외부 의존성이다.
		- 도메인 모델이라면 프로세스 외부 협력자를 사용하면 안 된다.
		- 테스트에서 목 체계가 복잡하기 때문에 유지비가 더 든다.
- 네 가지 코드 유형
	- 도메인 모델과 알고리즘
		- 도메인 모델 또는 복잡한 알고리즘
		- 단위 테스트 하면 가장 이롭다. 단위 테스트가 매우 가치 있고 저렴하다.
	- 간단한 코드
		- 매개변수가 없는 생성자나 한 줄 속성 등
		- 테스트할 필요가 전혀 없다. 테스트 가치가 0에 가깝다.
	- 컨트롤러
		- 도메인 크래스와 외부 애플리케이션 같은 구성 요소의 작업을 조정
		- 포괄적인 통합 테스트의 일부로서 간단히 테스트해야 한다.
	- 지나치게 복잡한 코드
		- 덩치가 큰 컨트롤러
		- 단위 테스트가 어렵지만, 테스트 커버리지 없이 내버려두는 것은 위험하다.
		- 알고리즘과 컨트롤러라는 두 부분으로 나눠서 리팩토링하는 것이 일반적이다.
		- 코드가 더 중요하거나 복잡해질수록 협력자는 더 적어야 한다.
	- ![](assets/Pasted%20image%2020231005112541.png)

### 험블 객체 패턴을 사용해 지나치게 복잡한 코드 분할하기

- 지나치게 복잡한 코드를 쪼개려면, 험블 객체 패턴을 써야 한다.
- 지나치게 복잡한 코드에서 테스트 가능한 부분을 추출해 이를 둘러싼 험블 객체를 만든다.
	- ![](assets/Pasted%20image%2020231005114408.png)
- 험블 객체의 예시
	- 육각형 아키텍처의 애플리케이션 서비스 계층
	- 함수형 아키텍처의 가변 셸
	- MVP와MVC 패턴의 프리젠터와 컨트롤러
	- DDD에 나오는 Aggregate 패턴
- 비즈니스 로직과 오케스트레이션을 계속 분리해야 하는 이유는 테스트 용이성이 좋아져서만이 아니다.
	- 코드 복잡도를 해결할 수 있으며, 유지 보수도 쉽게 해준다.