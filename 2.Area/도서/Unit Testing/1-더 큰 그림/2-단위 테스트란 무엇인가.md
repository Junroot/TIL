# 단위 테스트란 무엇인가

## '단위 테스트'의 정의

- 단위 테스트는
	- 작은 코드 조각을 검증하고,
	- 빠르게 수행하고,
	- 격리된 방식으로 처리하는 자동화된 테스트다.
- 격리 문제는 단위 테스트의 고전파와 런던파를 구분할 수 있게 해주는 근원적 차이에 속한다.

### 격리 문제에 대한 런던파의 접근

- 런던파에서는 테스트 대상 시스템을 협력자에게서 격리한다.
	- 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존하면 이 모든 의존성을 테스트 대역(test double)으로 대체해야 한다.
- 장점
	- 테스트가 실패하면 코드베이스의 어느 부분이 고장 났는지 확실히 알 수 있다.
	- 객체 그래프를 분할할 수 있다. 테스트 대역을 사용해서 복잡한 의존성을 무시하고 객체 그래프를 만들지 않아도 된다.
	- 한 번에 한 클래스만 테스트하라는 지침을 도입하면 전체 단위 테스트 스위트를 간단한 구조로 할 수 있다.
- 고전파는 SUT(System Under Test)와 협력자의 상태를 검증한다.
-  런던파는 SUT의 상태, SUT와 협력자의 상호 작용을 검증한다.

### 격리 문제에 대한 고전파의 접근

- 고전파에서는 코드를 격리하는 방식이 아닌, 단위 테스트를 서로 격리 시킨다.
	- 여러 클래스가 모두 메모리에 상주하고 공유 상태에 도달하지 않는 한, 여러 클래스를 한 번에 테스트해도 괜찮다.
- 공유 의존성, 비공개 의존성, 프로세스 외부 의존성
	- 공유 의존성: 테스트 간에 공유되고 서로의 결과에 영향을 미칠 수 있는 수단을 제공하는 의존성
		- 정적 가변 필드, 데이터베이스 등
		- 싱글턴 인스턴스는 프로덕션 코드에서는 단 하나만 있지만, 테스트에서는 각 테스트마다 새 인스턴스를 만들 수 있으므로 공유 의존성이 아니다.
	- 비공개 의존성: 공유하지 않는 의존성
	- 프로세스 외부 의존성: 애플리케이션 실행 프로세스 외부에서 실행되는 의존성이며, 아직 메모리에 없는 데이터에 대한 프록시다.
		- 데이터베이스는 프로세스 외부 이면서 공유 의존성
		- 그러나 각 테스트 전에 도커 컨테이너로 데이터베이스를 시작하면 프로세스 외부이면서 공유하지 안흔ㄴ 의존성
- 보통 테스트 간에 공유 상태를 일으키는 의존성에 대해서만 테스트 대역을 사용한다.
	- 공유 의존성은 일반 실행 프로세스 외부에 있어서, 테스트 대역을 사용하여 테스트 실행속도를 높일 수 있다.
	- 프로세스 외부 의존성을 가진 테스트는 단위 테스트 영역에서 통합 테스트 영역으로 넘어간다.