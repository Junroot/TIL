# 스프링 부트 액추에이터 사용하기

- 액추에이터: 스프링 부트 애플리케이션의 모니터링이나 메트릭과 같은 기능을 HTTP와 JMX 엔드포인트를 통해 제공한다.

## 액추에이터 개요

- 액추에이터가 노출하는 엔드포인트를 사용하면 실행 중인 스프링 부트 애플리케이션의 내부 상태에 관한 것을 알 수 있다.
	- ![](assets/Pasted%20image%2020231026200631.png)
	- ![](assets/Pasted%20image%2020231026200640.png)
### 액추에이터의 기본 경로 구성하기

- 기본적으로 액추에이터의 모든 엔드포인트 경로에는 /actuator가 앞에 붙는다.
- 기본 경로를 수정하고 싶으면, `management.endpoint.web.base-path` 속성을 설정하여 변경할 수 있다.

### 액추에이터 엔드포인트의 활성화와 비활성화

- 엔드포인트의 노출 여부를 제어할 때는 `management.emdpoints.web.exposure.include`와 `management.endpoints.web.exposure.exclude` 속성을 사용하면 노출을 원하는 엔드포인트를 지정할 수 있다.
- /health, /info, /beans, /conditions 엔드포인트만 노출하기
	- ![](assets/Pasted%20image%2020231026201121.png)
- 모든 엔드포인트 노출하기
	- ![](assets/Pasted%20image%2020231026201135.png)
- /threaddump와 /heapdump를 제외한 모든 엔드포인트 노출하기
	- ![](assets/Pasted%20image%2020231026201203.png)
- /health와 /info 외에 더 많은 엔드포인트를 노출해야 한다면 다른 엔드포인트의 접근을 제한하기 위해 스프링 시큐리티를 구성하는 것이 좋다.

## 액추에이터 엔드포인트 소비하기

- 액추에이터가 제공하는 엔드포인트에는 어떤 것이 있는지 알아보기 위해 액추에이터의 기본 경로에 대해 GET 요청을 하면 각 엔드포인트의 HATEOAS 링크를 응답으로 받을 수 있다.
	- ![](assets/Pasted%20image%2020231106202235.png)

### 애플리케이션 기본 정보 가져오기

- /info: 애플리케이션에 관해 알려준다.
	- 기본적으로 제공하는 정보가 없다.
	- .info으로 시작하는 하나이 상의 구성 속성을 생성하면 응답으로 정보를 준다.
		- ![](assets/Pasted%20image%2020231106202512.png)
		- ![](assets/Pasted%20image%2020231106202517.png)
- /health: 애플리케이션의 건강 상태를 알려준다.
	- 기본적으로는 애플리케이션의 종합적인 건강 지표 상태만 알려준다.
		- ![](assets/Pasted%20image%2020231106202821.png)
	- 건강 지표는 애플리케이션이 상호 작용하는 외부 시스템의 건강 상태를 나타낸다.
		- UP: 외부 시스템이 작동 중이고 접근 가능하다.
		- DOWN: 외부 시스템이 작동하지 않거나 접근할 수 없다.
		- UNKNOWN: 외부 시스템의 상태가 분명하지 않다.
		- OUT_OF_SERVICE: 외부 시스템에 접근할 수 있지만, 현재는 사용할 수 없다.
	- 모든 건강 지표의 건강 상태는 다음 규칙에 따라 애플리케이션의 전체 건강 상태로 종합된다.
		- 모든 건강 지표가 UP이면 애플리케이션의 건강 상태도 UP
		- 하나 이상의 건강 지표가 DOWN이면 애플리케이션의 건강 상태도 DOWN
		- 하나 이상의 건강 지표가 OUT_OF_SERVICE이면 애플리케이션의 건강 상태도 OUT_OF_SERVICE
		- UNKNOWN 건강 상태는 무시되며, 애플리케이션의 종합 건강 상태에 고려되지 않는다.
	- `management.endpoint.health.show-deatils` 속성의 기본 값은 never인데, always를 설정하면 건강 상태의 상세 내역을 보여준다.
		- `when-authorized`로 설정하면, 클아이언트가 완변하게 인가된 경우에 한해서 상세 내역을 보여준다.
		- ![](assets/Pasted%20image%2020231106203117.png)
		- ![](assets/Pasted%20image%2020231106203220.png)
	- 자동-구성에서는 애플리케이션과 관련된 건강 지표만 /health 엔드포인트의 응답에 나타낸다.
		- 카산드라
		- 구성 서버
		- Couchbase
		- 유레카
		- Hystrix
		- JDBC 데이터 소스
		- Elasticsearch
		- InfuxDB
		- JMS 메시지 브로커
		- LDAP
		  이메일 서버
		- Neo4j
		- Rabbit 메시지 브로커
		- Redis
		- Solr
	- 또한, 서드파티 라이브러리들도 자신들의 건강 지표를 제공할 수 있다.