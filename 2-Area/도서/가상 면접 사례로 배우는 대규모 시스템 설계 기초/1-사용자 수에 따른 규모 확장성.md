# 사용자 수에 따른 규모 확장성

## 단일 서버

- 모든 컴포넌트가 한 대의 서버에서 실행되는 간단한 시스템 설계
- ![](assets/Pasted%20image%2020240214002520.png) 
	1. 사용자는 도메인 이름을 DNS에 질의하여 IP 주소로 변환한다. DNS는 보통 제3 사업자가 제공하는 유료 서비스를 이용하게 되므로, 우리 시스템의 일부가 아니다.
	2. DNS 주소 결과로 IP 주소가 반환된다.
	3. 해당 주소로 HTTP 요청이 전달된다.
	4. 요청을 받은 웹 서버는 HTML 페이지나 JSON 형태의 응답을 반환한다.
- 웹 앱: 비즈니스 로직, 데이터 저장을 위해 서버 구현용 언어(자바, 파이썬 등)를 사용하고, 프레제테이션용으로는 클라이언트 구현용 언어(HTML, 자바스크립트 등)을 사용한다.
- 모바일 앱: 모바일 앱과 웹 서버 간 통신을 위해서 HTTP 프로토콜을 사용하고, HTTP 프로토콜을 통해 반환될 응답 데이터의 포맷으로는 보통 JSON이다.

## 데이터베이스

- 사용자가 늘면 서버 하나로는 충분하지 않아서 여러 서버를 두어야 한다.
	- 웹/모바일 트래픽 처리 용도와 데이터베이스용으로 분리하면 각각 독립적으로 확장해 나갈 수 있다.
	- ![](assets/Pasted%20image%2020240214003937.png)
- 데이터베이스 종류
	- 관계형 데이터베이스
		- MySQL, 오라클 데이터베이스, PostgreSQL 등
		- SQL을 사용하면 여러 테이블에 있는 데이터를 그 관계에 따라 join하여 합칠 수 있다.
	- 비-관계형 데이터베이스
		- CouchDB, Neo4j, Cassandra 등
		- 키-값 저장소, 그래프 저장소, 칼럼 저장소, 문서 저장소로 나눌 수 있다.
		- 비-관계형 데이터베이스는 일반적으로 join 연산을 지원하지 않는다.
- 비-관계형 데이터베이스가 바람직한 경우
	- 아주 낮은 응답 지연시간이 요구됨
	- 다루는 데이터가 비정형(unstructured)이라 관계형 데이터가 아님
	- 데이터를 직렬화하거나 역직렬화 할 수 있기만 하면 됨
	- 아주 많은 양의 데이터를 저장할 필요가 있음

## 수직적 규모 확장 vs 수평적 규모 확장

- 스케일 업(수직적 규모 확장): 서버에 고사양 자원(CPU, RAM 등)을 추가하는 행위
- 스케일 아웃(수평적 규모 확장): 더 많은 서버를 추가하여 성능을 개선하는 행위 
- 서버로 유입되는 트래픽의 양이 적을 때 유리하고, 단순하다.
	- 하지만 확장에 한계가 존재한다. 한 대의 서버에 CPU나 메모리를무한대로 증설할 방법은 없다.
	- 또한, 장애에 대한 자동복구(failover) 방안이나 다중화(redundancy) 방안을 제시하지 않는다.

### 로드밸런서

- 로드밸런서: 부하 분산 집합에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할
- 사용자는 로드밸런서의 public IP 주소로 접속하고, 웹 서버는 클라이언트의 접속을 직접 처리하지 않는다.
	- 보안을 위해, 서버 간 통신에는 privat IP 주소가 이용된다.
	- 서버1이 다운되면 모든 트래픽은 서버2로 전송되며, 전체가 다운되는 일이 방지된다.
	- 웹 사이트로 유입되는 트래픽이 가파르게 증가하면 웹 서버 계층에 서버를 추가하기만 하면 된다.
	- ![](assets/Pasted%20image%2020240214010656.png)

### 데이터베이스 다중화

- 많은 데이터베이스 관리 시스템이 다중화를 지원한다.
- 보통은 데이터베이스 사이에 주(master)-부(slave) 관계를 설정하고 데이터 원본은 주 서버에, 사본은 부 서버에 저장하는 방식이다.
- 쓰기 연산은 주 데이터베이스에서만 지원한다.
- 부 데이터베이스는 주 데이터베이스로부터 그 사본을 전달받으며, 읽기 연산만 지원한다.
- 대부분의 애플리케이션은 읽기 연산의 비중이 쓰기 연산보다 훨씬 높다. 따라서 통상 부 데이터베이스의 수가 주 데이터베이스의 수보다 많다.
- 얻을 수 있는 장점
	- 더 나은 성능: 병렬로 처리될 수 있는 쿼리 수가 늘어나므로, 성능이 좋아진다.
	- 안정성: 자연 재해 등의 이유로 데이터베이스 서버 가운데 일부가 파괴되어도, 지역적으로 떨어진 데이터베이스로 인해 데이터가 보존된다.
	- 가용성: 지역적으로 떨어진 데이터베이스에 복제해 둠으로써, 하나의 데이터베이스 서버에 장애가 발생하더라도 다른 서버에 있는 데이터를 가져와 계속 서비스할 수 있게 된다.
- 가용성을 높이는 방법
	- 부 서버가 한 대 뿐인데 부 서버가 다운된 경우: 읽기 연산을 한시적으로 모두 주 데이터베이스로 전달
	- 부 서버가 여러 대인 경우 부 서버 다운된 경우: 읽기 연산은 나머지 부 데이터베이스 서버들로 분산되어 전달
	- 주 서버가 다운된 경우: 부 데이터베이스 서버가 주 서버가 되며, 모든 연산은 새로운 주 서버에서 수행됨
		- 부 서버가 보관된 데이터가 최신 상태가 아닐 수 있기 때문에, 복구 스크립트를 돌려서 추가해야 한다.
		- 다중 마스터나 원형 다중화 방식을 도입하면 이런 상황에 대처하는데 도움이 된다.