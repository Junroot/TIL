---
tags:
  - 도서/모두의-네트워크
---

# 4장 데이터 링크 계층 : 랜에서 데이터 전송하기

## 데이터 링크 계층이 역할과 이더넷

- 데이터 링크 게층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층이다.
- LAN에서 데이터를 정상적으로 주고받기 위해서 데이터 링크 계층에 이더넷을 주로 사용한다.
- 이더넷에 목적지 정보(MAC주소)를 추가해서 자신의 데이터가 아니면 무시하도록 설계되어있다.
- 이더넷은 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조로 되어있다.
    - 동시에 케이블이 지나가면 충돌하기 때문에 데이터를 보내는 시점을 늦추는 방법을 사용한다.
    - 이를 CSMA/CD(Carrier Sense Multiple Access with Collision Detection)라고 부른다.
    - CS: 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 확인한다.
    - MA: 케이블에 데이터가 흐르고 있지 않다면 데이터를 보내도 좋다.
    - CD: 충돌이 발생하고 있는지 확인한다.
    - 하지만 최근에는 효율이 좋지 않다는 이유로 CSMA/CD를 사용하지 않고, 스위치라는 네트워크 장비를 사용한다.

## MAC 주소의 구조

- MAC 주소: 랜 카드를 제조할 때 새겨지는 물리 주소로 전 세계에서 유일한 번호로 할당된다.
- MAC 주소는 48비트로 앞쪽 24비트는 랜 카드를 만드는 제조사의 번호, 뒤쪽은 24비트는 제조사가 랜 카드에 붙인 일련번호다.
- 데이터 링크 계층으로 캡슐화 할 때는 이더넷 헤더와 트레일러를 붙인다. 이렇게 데이터 링크 계층에서 캡슐화된 데이터를 프레임이라고 부른다.
    - 이더넷 헤더
        - 목적지 MAC 주소(6바이트) + 출발지 MAC 주소(6바이트) + 이더넷 유형(2바이트)
        - 이더넷 유형은 전송되는 상위 계층 프로토콜의 종류를 의미한다.(예: 0800 == IPv4)
    - 트레일러
        - FCS(Frame Check Sequence): 데이터 전송 도중에 오류가 발생했는지 확인하는 용도

## 스위치의 구조

- 허브와 같이 여러 개의 포트를 가지고 있다. 그래서 스위칭 허브라고도 불린다.
- 스위치 내부에는 MAC 주소 테이블(브리지 테이블)이 존재한다. 이는 스위치의 포트 번호와 이 포트에 연결되어 있는 MAC 주소를 저장한다.
    - 처음에는 MAC 주소 테이블에 아무것도 등록되어 있지 않다.
    - 컴퓨터에서 스위치에 프레임을 보내고, 출발지 MAC주소가 등록되어 있지 않으면 MAC 주소와 함께 등록한다. 이를 MAC 주소 학습 기능이라고 한다.
    - 목적지 MAC 주소가 등록되어 있지않으면 모든 포트로 데이터를 보내게 되는데 이를 플러딩(flooding)이라고 부른다.
    - 목적지 MAC 주소가 등록되어 있으면, 해당 포트로만 데이터를 보낸다. 이를 MAC 주소 필터링이라고 불른다.
        - 불필요한 데이터를 네트워크에 전송하지 않게 된다.

## 데이터가 케이블에서 충돌하지 않는 구조

- 통신 방식에는 전이중 통신 방식과 반 이중 통신 방식이 있다.
    - 전이중 통신 방식: 데이터의 송수신을 동시에 통신하는 방식
    - 반이중 통신 방식: 회선 하나로 송신과 수신을 번갈아가면서 통신하는 방식
    - 반이중 통신 방식은 충돌이 발생할 수 있다.
- 컴퓨터 끼리 직접 랜 케이블로 연결하면, 선 네 쌍을 사용하기 때문에 전이중 통신 방식이 된다.
- 허브 내부는 회선 하나를 사용하여 송수신을 번갈아 사용하기 때문에 반이중 통신 방식을 사용한다.
- 스위치 내부는 충돌이 일어나지 않는 구조기 때문에 전이중 통신 방식으로도 데이터를 주고 받을 수 있다.
- 최근에는 대부분 허브를 사용하지 않고 스위치를 사용한다.
- 충돌 도메인: 충돌이 발생할 때 그 영향이 미치는 범위
    - 허브는 연결되어 있는 컴퓨터 전체가 하나의 충돌이 된다.
    - 충돌 도메인이 넓을 수록 네트워크 지연이 심해진다. 따라서, 충돌 도메인의 범위를 좁히는 것이 중요하다.

## ARP

- ARP(Address Resolution Protocol): 목적지 컴퓨터의 IP 주소를 이용하여 MAC 주소를 찾기 위한 프로토콜
- 출발지 컴퓨터가 목적지 MAC 주솔르 알아내기 위해 네트워크에 브로드캐스트르 하는데 이것을 ‘ARP 요청’이라고 부른다.
- ARP 요청이 들어오면 지정된 IP 주소를 가진 컴퓨터만 MAC 주소를 응답으로 보낸다. dlfmf ‘ARP 응답’이라고 부른다.
- 출발지 컴퓨터에서는 MAC 주소를 얻은 뒤 MAC 주소와 IP 주소의 매핑 정보를 메모리에 보관한다. 이를 ARP 테이블이라고 부른다
- IP 주소가 변경되면 제대로 통신할 수 없기 때문에 ARP 테이블에서는 보존 기간을 ARP 캐시로 지정하고 일정 시간이 지나면 삭제하고 다시 ARP 요청을 한다.