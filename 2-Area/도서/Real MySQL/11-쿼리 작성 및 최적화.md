# 쿼리 작성 및 최적화

## 쿼리 작성과 연관된 시스템 변수

### SQL 모드

- MySQL 서버의 `sql_mode` 라는 시스템 설정에는 여러 개의 값이 동시에 설정될 수 있다.
	- `sql_mode`를 설정할 때는 구분자(,)를 이용해 키워드를 동시에 여러 개 설정할 수 있다.
- MySQL 서버의 `sql_mode` 시스템 변수에 설정된 값들은 SQL 문장 작성 규칙뿐만 아니라 MySQL 서버 내부적으로 자동 실행되는 데이터 타입 변환 및 기본값 제어 등과 관련된 옵션도 가지고 있다.
	- 그래서 일단 MySQL 서버에 사용자 테이블을 생성하고 데이터를 저장하기 시작했담녀 가능한 한 `sql_mode` 시스템 변수의 내용은 변경하지 않는 것이 좋다.
- 명시 가능한 시스템 변수
	- `STRICT_ALL_TABLES`, `STRICT_TRANS_TABLES`
	- `ANSI_QUATES`
	- `ONLY_FULL_GROUP_BY`
	- `PIPE_AS_CONCAT`
	- `PAD_CHAR_TO_FULL_LENGTH`
	- `NO_BACKSLASH_ESCAPES`
	- `IGNORE_SPACE`
	- `REAL_AS_FLOAT`
	- `NO_ZERO_IN_DATE`, `NO_ZERO_DATE`
	- `ANSI`
	- `TRADITIONAL`

### 영문 대소문자 구분

- MySQL 서버는 설치된 운영체제에 따라 테이블명의 대소문자를 구분한다.
	- 이는 MySQL의 DB나 테이블이 디스크의 디렉터리나 파일로 매핑되기 때문이다.
	- 윈도우에 설치된 MySQL에서는 대소문자를 구분하지 않지만 유닉스 계열의 운영체제에서는 대소문자를 구분한다.
- MySQL 서버가 운영체제와 관계없이 대소문자 구분의 영향을 받지 않게할면 MySLQ 서버 설정 파일에 `lower_case_table_names` 시스템 변수를 설정하면 된다.
	- 1로 설정하면 모두 소문자로만 저장되고, MySQL 서버가 대소문자를 구분하지 않는다.
	- 기본값인 0은, DB나 테이블명에 대해 대소문자를 구분한다.
	- 윈도우와 macOS에서는 2를 설정할 수 있는데, 이 경우에는 저장은 대소문자를 구분해서 하지만 MySQL의 쿼리에서는 대소문자를 구분하지 않게 해준다.
- 이러한 설정 자체를 떠나서 가능함녀 초기 DB나 테이블을 생성할 때 대문자 또는 소문자만으로 통일해서 사용하는 편이 좋다.

### MySQL 예약어

- 생성하는 데이터베이스나 테이블, 컬럼의 이름을 예약어와 같은 키워드로 생성하면 해당 컬럼이나 테이블을 SQL에서 사용하기 위해 항상 역따옴표(\`)나 쌍따옴표로 감싸야 한다.
- 예약어를 모두 구분해서 기억하기란 쉽지 않기 때문에, 테이블을 생성할 때 역따옴표로 테이블을 명이나 컬럼명을 둘러싸지 않고 생성해보는 것이 좋다.
	- 예약어가 존재한다면 에러가 발생할 것이다.

## MySQL 연산자와 내장 함수

- MySQL에서만 사용되는 연산자나 표기법이 있다.
- 이번 절에서는 MySQL에서만 사용 가능한 연산자도 함께 살펴보겟지만, 가능하면 SQL의 가독성을 높이기 위해 ANSI 표준 형태의 연산자를 사용하기를 권장한다.

### 리터럴 표기법 문자열

#### 문자열

- SQL 표준에서는 항상 홀따옴표(')를 사용해서 표시한다.
- 하지만 MySQL에서는 다음과 같이 쌍따옴표를 사용해 문자열을 표기할 수도 있다.
	- ![](assets/Pasted%20image%2020240822030808.png)
- SQL 표준에서는 문자열 값에 홀땅모표가 포함돼 있을 때 홀따옴표를 두번 연속해서 입력하면 된다.
- 하지만 MySQL에서는 쌍땅모표와 홀땅모푤르 혼합해서 이러한 문제를 피해 가기도 한다.
	- ![](assets/Pasted%20image%2020240822030849.png)
- SQL에서는 사용되는 식별자가 키워드와 충돌할 때 오라클이나 PostgreSQL에서는 쌍따옴표나 대괄호로 감싸소 충돌을 피한다.
- MySQL에서는 역따옴표(\`)를 감싸서 사용하면 예약어와의 충돌을 피할 수 있다.
	- ![](assets/Pasted%20image%2020240822030948.png)
	- ![](assets/Pasted%20image%2020240822031015.png)

#### 숫자

- 숫자 값을 상수로 사용할 때는 따옴표(' 또는 ") 없이 숫자 값을 입력하면 된다.
- MySQL은 숫자 타입과 문자열 타입 간의 비교에서 숫자 타입을 우선시하므로 문자열 값을 숫자 값으로 변환한 후 비교를 수행한다.
	- 첫 번째 쿼리는 주어진 상숫값을 숫자로 변환하는데, 이때는 상숫값 하나만 변환하므로 성능과 관련된 문제가 발생하지 않는다.
	- 두 번째 쿼리는 `string_column`  컬럼의 모든 문자열 값을 숫자로 변환해 비교하므로 인덱스가 있더라도 이를 이용하지 못한다.
	- ![](assets/Pasted%20image%2020240822031300.png)

#### 날짜

- 다른 DBMS에서 날짜 타입을 비교하거나 INSERT 하려면 문자열을 DATE 타입으로 변환하는 코드가 필요하다.
- 하지만 MySQL에서는 정해진 형태의 날짜 포맷으로 표기하면 MySQL 서버가 자동으로 DATE나 DATETIME 값으로 변환한다.
- 아래 두 쿼리는 MySQL에서 동작에 차이가 없다.
	- ![](assets/Pasted%20image%2020240822031539.png)

#### 불리언

- BOOL 이나 BOOLEAN이라는 타입이 있지만 사실 이것은 TINYINT 타입에 대한 동의어일 뿐이다.
- MySQL에서는 FALSE가 정숫값이 0이 되지만 TRUE는 C/C++ 언어와 달리 1만을 의미한다는 점에 주의해야한다.
- 그래서 숫자 값이 저장된 컬럼을 TRUE나 FALSE로 조회하려면 0이나 1이외의 숫자 값은 조회되지 않는다.
	- ![](assets/Pasted%20image%2020240822031919.png)

### MySQL 연산자

#### 동등(Equal) 비교(=, <=>)

- 동등 비교는 "=" 기호를 사용해 비교를 수행하면된다.
- MySQL에서는 추가로 NULL-Safe 동등 비교를 위해 "<=>" 연산자도 제공한다.
	- ![](assets/Pasted%20image%2020240822032154.png)
	- ![](assets/Pasted%20image%2020240822032200.png)

#### 부정(Not-Equal) 비교(<>, !=)

- 일반적으로 "<>"를 많이 사용한다.
- "!=" 도 사용 가능한데, SQL 문장에서 혼용되면 가독성이 떨어지므로 통일해서 사용하는 방법을 권장한다.


#### NOT 연산자(!)

- TRUE 또는 FALSE 연산의 겨로갈르 반대로 만드는 연산자로 "NOT"을 사용한다.
- 불리언 값뿐만 아니라 숫자나 문자열 표현식에서도 사용할 수 잇지만 부정의 결괏값을 정확히 예측할 수 없는 경우에는 사용을 자제하는 것이 좋다.
- ![](assets/Pasted%20image%2020240822032431.png)
- ![](assets/Pasted%20image%2020240822032437.png)

#### AND(&&)와 OR(||) 연산자

- MySQL에서는 AND와 OR 뿐만 아니라 "&&"dhk "||"의 사용도 허용한다.
- 오라클에서는 "||"를 불리언 표현식의 결합 연산자가 아니라 문자열을 결합하는 연산자로 사용한다.
- sql_mode 시스템 변수값에 `PIPE_AS_CONCAT`을 설정하면 MySQL에서도 "||"를 문자열을 결합하는 연산자로 사용할 수 있다.
- SQL의 가독성을 높이기 위해 다른 용도로 사용될 수 있는 "&&" 연산자와 "||" 연산자는 사용ㅇ르 자제하는 것이 좋다.
	- ![](assets/Pasted%20image%2020240822032724.png)

#### 나누가(/, DV)와 나머지(%, MOD) 연산자

- 일반적인 나누기 연산자 "/"
- 나눈 곲의 정수 부분만 가져오려면 DIV
- 나눈 결과의 나머지를 가져오는 연산자로는 "%" 또는 MOD 연산자
- ![](assets/Pasted%20image%2020240822033002.png)
