# 스프링 배포하기

## 배포 옵션

- 빌드 및 실행 방법
	- STS나 IntelliJ IDEA 등의 IDE에서 애플리케이션을 빌드하고 실행
	- 메이븐 springboot:run이나 그래들 bootRun 태스크를 사용해서 명령행에서 애플리케이션을 빌드하고 실행한다.
	- 메이븐이나 그래들을 사용해서 실행 가능한 JAR 파일을 생성한다.
	- 메이븐이나 그래들을 사용해서 WAR 파일을 생성한다.
- 배포 방법
	- 자바 애플리케이션 서버에 배포하기: 톰캣, 웹스피어, 웹로직 등의 자바 애플리케이션 서버에 애플리케이션을 배포해야 한다면, 선택의 여지없이 WAR 파일로 애플리케이션을 빌드해야 한다.
	- 클라우드에 배포하기: AWS, Azure 등의 클라우드 플랫폼으로 배포한다면, 실행 가능한 JAR 파일이 최사으이 선택이다. WAR보다 JAR 형식이 훨씬 간단하므로 WAR 파일 배포를 지원하더라도 JAR 파일로 배포하는 것이 좋다.

## WAR 파일 빌드하고 배포하기

- JAR 파일로 빌드할 때는, 스프링 부트의 자동-구성 덕분에 스프링을 `DispatcherServlet`을 선언하기 위해 web.xml 파일이나 서블릿 초기화 클래스를 생성하지 않아도 되었다.
- 그러나 WAR 파일을 빌드하기 위해서는 `DispatcherServlet`을 선언하는 서블릿 초기화 클래스도 WAR 파일에 포함해야 한다.
- 스프링 부트는 `SpringBootServletInitializr`를 사용해서 `DispatcherServlet` 구성을 쉽게 해준다.
	- `SpringBootServletInitializer`는 스프링 `WebApplicationInitializer`의 구현체다.
	- `SpringServletInitialzer`의 역할
		- `DispatcherServlet` 구성
		- `Filter`, `Servlet`, `ServletContextInitialzer`타입의 빈들을 스프링 애플리케이션 컨텍스트에서 찾아서 서블릿 컨텍스트에 바인딩
- 아래 사진과같이 `sources()` 메서드를 오버라이드하여, 구성 클래스를 등록하면 된다.
	- ![](assets/Pasted%20image%2020231122230347.png)
- 빌드하기
	- 메이븐으로 빌드하는 경우 pom.sml 파일의 `<packaging>` 요소를 war로 설정하면 된다.
		- 빌드 명령어: `mvnw package`
		- ![](assets/Pasted%20image%2020231122230627.png)
	- 그래들은 build.gradle 파일에 war 플러그인만 추가하면 된다.
		- 빌드 명령어: `gradlew build`
		- ![](assets/Pasted%20image%2020231122230649.png)
- 빌드가 완료되면 WAR 파일이 build/libs 디렉터리에 생성된다.
- WAR 파일을 빌드했더라도 실행 가능한 JAR 파일처럼 여전히 명령행에서 실행할 수 있다.

```
java -jar target/ingredient-service-0.0.19-SNAPSHOT.war
```

- WAR 파일은 과거에 주로 사용헀던 자바 애플리케이션 서버에 애플리케이션을 배포하기 위해 설계되었다.
	- 현대의 클라우드 배포에는 WAR 파일이 필요하지 않으며, 지원하지 않는 경우도 있다.
